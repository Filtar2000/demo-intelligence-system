<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Check ‚Äî DIS</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&family=JetBrains+Mono:wght@500;600;700&display=swap"
        rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="styles/main.css">

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Meyda.js (Audio Features) -->
    <script src="https://unpkg.com/meyda/dist/web/meyda.min.js"></script>
</head>

<body>

    <nav class="navbar">
        <div class="logo">DIS</div>
        <ul class="nav-links">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="analysis.html" class="active">Analysis</a></li>
            <li><a href="label-fit.html">Label Match</a></li>
            <li><a href="crm.html">CRM</a></li>
        </ul>
        <a href="#" class="btn-login" id="loginBtn">Login</a>
    </nav>

    <main class="analysis-container">
        <section class="analysis-header">
            <h1>Track Check</h1>
            <p>Drop your track here. We'll break down loudness, tempo, dynamics, and intro ‚Äî so you know where it stands
                before you send it out.</p>
        </section>

        <!-- Drag & Drop Zone -->
        <div id="drop-zone" class="drop-zone">
            <div class="drop-content">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" class="icon-upload">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <p>Drag & Drop your audio file here</p>
                <p class="sub-text">MP3 or WAV, max 50MB</p>
                <input type="file" id="file-input" accept="audio/mpeg, audio/wav" hidden>
                <button id="browse-btn" class="btn-secondary">Browse Files</button>
            </div>
            <div id="file-info" class="file-info hidden">
                <p id="filename-display">track_name.mp3</p>

                <!-- Genre Selection -->
                <div class="genre-selector">
                    <label for="genre-select">Genre *</label>
                    <select id="genre-select" required>
                        <option value="" disabled selected>-- Choose Genre --</option>
                        <optgroup label="House">
                            <option value="house">House</option>
                            <option value="deep house">Deep House</option>
                            <option value="tech house">Tech House</option>
                            <option value="future house">Future House</option>
                            <option value="bass house">Bass House</option>
                            <option value="afro house">Afro House</option>
                            <option value="organic house">Organic House</option>
                        </optgroup>
                        <optgroup label="Techno">
                            <option value="melodic house & techno">Melodic House & Techno</option>
                            <option value="peak-time techno">Peak-time Techno</option>
                            <option value="hard techno">Hard Techno</option>
                            <option value="industrial techno">Industrial Techno</option>
                            <option value="minimal">Minimal / Deep Tech</option>
                        </optgroup>
                        <optgroup label="Other">
                            <option value="trance">Trance</option>
                            <option value="psy-trance">Psy-Trance</option>
                            <option value="progressive house">Progressive House</option>
                            <option value="indie dance">Indie Dance</option>
                            <option value="nu disco">Nu Disco</option>
                            <option value="dubstep">Dubstep</option>
                            <option value="drum and bass">Drum & Bass</option>
                            <option value="breaks">Breaks</option>
                            <option value="electro house">Electro House</option>
                            <option value="big room">Big Room</option>
                            <option value="hard dance">Hard Dance / Hardcore</option>
                            <option value="downtempo">Electronica / Downtempo</option>
                            <option value="ambient">Ambient / Experimental</option>
                            <option value="dance">Dance / Pop-Dance</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Mood Selection -->
                <div class="genre-selector">
                    <label for="mood-select">Mood *</label>
                    <select id="mood-select" required>
                        <option value="" disabled selected>-- Describe the mood --</option>
                        <option value="dark">Dark / Mysterious</option>
                        <option value="hypnotic">Hypnotic / Trippy</option>
                        <option value="driving">Driving / Relentless</option>
                        <option value="uplifting">Uplifting / Euphoric</option>
                        <option value="emotional">Emotional / Melancholic</option>
                        <option value="ethereal">Ethereal / Dreamy</option>
                        <option value="groovy">Groovy / Funky</option>
                        <option value="energetic">Energetic / Raw</option>
                        <option value="atmospheric">Atmospheric / Cinematic</option>
                        <option value="warm">Warm / Deep</option>
                    </select>
                </div>

                <!-- Energy Selection -->
                <div class="genre-selector">
                    <label for="energy-select">Energy *</label>
                    <select id="energy-select" required>
                        <option value="" disabled selected>-- Energy level --</option>
                        <option value="high">High ‚Äî Festival / Peak-time</option>
                        <option value="medium">Medium ‚Äî Club / Groove</option>
                        <option value="low">Low ‚Äî Lounge / Afterhours</option>
                    </select>
                </div>

                <button id="analyze-btn" class="btn-primary">Analyze Track</button>
            </div>
        </div>

        <!-- Loader -->
        <div id="loader" class="loader hidden"></div>

        <!-- Results Section (Hidden initially) -->
        <section id="results-section" class="results-section hidden">
            <h2 class="section-title">Analysis Results</h2>

            <div class="analysis-grid-container">
                <!-- Left: Score Circle -->
                <div class="score-container">
                    <div class="score-circle">
                        <svg class="progress-ring" width="200" height="200">
                            <circle class="progress-ring__circle" stroke="white" stroke-width="10" fill="transparent"
                                r="90" cx="100" cy="100" />
                        </svg>
                        <div class="score-text">
                            <span id="score-val">0</span>
                        </div>
                    </div>
                    <div id="score-status" class="score-status">--</div>
                </div>

                <!-- Right: Metrics Cards -->
                <div class="metrics-container">
                    <!-- BPM -->
                    <div class="metric-card-row">
                        <div class="metric-icon">üéµ</div>
                        <div class="metric-details">
                            <span class="metric-label">BPM</span>
                            <span class="metric-value-text" id="metric-bpm">--</span>
                        </div>
                        <div class="metric-bar-bg">
                            <div class="metric-bar-fill" id="bar-bpm"></div>
                        </div>
                    </div>

                    <!-- Loudness -->
                    <div class="metric-card-row">
                        <div class="metric-icon">üîä</div>
                        <div class="metric-details">
                            <span class="metric-label">Loudness (LUFS)</span>
                            <span class="metric-value-text" id="metric-lufs">--</span>
                        </div>
                        <div class="metric-bar-bg">
                            <div class="metric-bar-fill" id="bar-lufs"></div>
                        </div>
                    </div>

                    <!-- Peak / Headroom -->
                    <div class="metric-card-row">
                        <div class="metric-icon">üõë</div>
                        <div class="metric-details">
                            <span class="metric-label">Headroom</span>
                            <span class="metric-value-text" id="metric-headroom">--</span>
                        </div>
                        <div class="metric-bar-bg">
                            <div class="metric-bar-fill" id="bar-headroom"></div>
                        </div>
                    </div>

                    <!-- Intro -->
                    <div class="metric-card-row">
                        <div class="metric-icon">‚è≥</div>
                        <div class="metric-details">
                            <span class="metric-label">Intro Length</span>
                            <span class="metric-value-text" id="metric-intro">--</span>
                        </div>
                        <div class="metric-bar-bg">
                            <div class="metric-bar-fill" id="bar-intro"></div>
                        </div>
                    </div>

                    <!-- Stereo Width -->
                    <div class="metric-card-row">
                        <div class="metric-icon">üîä</div>
                        <div class="metric-details">
                            <span class="metric-label">Stereo Width</span>
                            <span class="metric-value-text" id="metric-stereo">--</span>
                        </div>
                        <div class="metric-bar-bg">
                            <div class="metric-bar-fill" id="bar-stereo"></div>
                        </div>
                    </div>

                    <!-- Crest Factor -->
                    <div class="metric-card-row">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-details">
                            <span class="metric-label">Crest Factor</span>
                            <span class="metric-value-text" id="metric-crest">--</span>
                        </div>
                        <div class="metric-bar-bg">
                            <div class="metric-bar-fill" id="bar-crest"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="suggestions-container" class="suggestions-container hidden">
                <h3>Suggestions</h3>
                <ul id="suggestions-list">
                    <!-- Suggestions will be injected here -->
                </ul>
            </div>

            <div class="action-area">
                <button id="find-labels-btn" class="btn-primary" disabled>Find Compatible Labels ‚Üí</button>
            </div>

            <!-- Label Matches Section (Hidden initially) -->
            <section id="labels-section" class="labels-section hidden">
                <h2 class="section-title">Compatible Labels</h2>
                <p class="section-subtitle" id="labels-subtitle"></p>
                <div id="labels-grid" class="labels-grid">
                    <!-- Label Cards injected here -->
                </div>
            </section>
        </section>

        <!-- Label Detail Modal -->
        <div id="label-detail-modal" class="modal-overlay hidden">
            <div class="modal-content label-detail-content">
                <button class="close-modal" id="close-label-detail">&times;</button>
                <div class="label-detail-header">
                    <h2 id="ld-name"></h2>
                    <span id="ld-score" class="ld-score-badge"></span>
                </div>
                <p id="ld-bio" class="ld-bio"></p>
                <div id="ld-tags" class="ld-tags"></div>
                <div class="ld-info-grid">
                    <div class="ld-info-item" id="ld-energy-wrap"><span class="ld-info-label">Energy</span><span
                            id="ld-energy" class="ld-info-value"></span></div>
                    <div class="ld-info-item" id="ld-email-wrap"><span class="ld-info-label">Demo Email</span><a
                            id="ld-email" class="ld-info-value ld-email-link" href="#"></a></div>
                    <div class="ld-info-item" id="ld-website-wrap"><span class="ld-info-label">Website</span><a
                            id="ld-website" class="ld-info-value ld-email-link" href="#" target="_blank"></a></div>
                    <div class="ld-info-item" id="ld-sc-wrap"><span class="ld-info-label">SoundCloud</span><a
                            id="ld-soundcloud" class="ld-info-value ld-email-link" href="#" target="_blank">Listen ‚Üí</a>
                    </div>
                </div>
                <div class="ld-actions">
                    <button id="ld-generate-pitch" class="btn-primary">‚úâ Draft Pitch Email</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Pitch Modal (Hidden) -->
    <div id="pitch-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚úâ Pitch Draft</h2>
                <button id="close-modal" class="close-modal">&times;</button>
            </div>

            <div id="pitch-loading" class="pitch-loading">
                <div class="loader"></div>
                <p>Writing your pitch...</p>
            </div>

            <div id="pitch-content" class="hidden">
                <div class="tabs">
                    <button class="tab-btn active" data-tab="0">Formal</button>
                    <button class="tab-btn" data-tab="1">Casual</button>
                    <button class="tab-btn" data-tab="2">Creative</button>
                </div>

                <div class="email-preview">
                    <div id="email-subject" class="email-subject">Subject: ...</div>
                    <div id="email-body" class="email-body"></div>
                </div>

                <div class="pitch-actions">
                    <button id="copy-btn" class="btn-secondary">üìã Copy to Clipboard</button>
                    <button id="mailto-btn" class="btn-primary">üìß Open in Mail App</button>
                </div>

                <div class="pitch-track-actions"
                    style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.08); text-align: center;">
                    <button id="mark-sent-btn" class="btn-secondary"
                        style="width: 100%; background: rgba(62,207,142,0.1); border-color: rgba(62,207,142,0.3); color: #3ecf8e;">
                        ‚úì Mark as Sent ‚Äî Track in Submissions
                    </button>
                    <p id="mark-sent-confirm" class="hidden"
                        style="color: #3ecf8e; margin-top: 10px; font-size: 0.9rem; font-weight: 500;">
                        ‚úÖ Tracked! You'll find it in your Submissions.
                    </p>
                </div>
            </div>

            <div id="pitch-error" class="pitch-error hidden">
                <p>‚ö† Failed to generate pitch. Please try again.</p>
                <button id="retry-pitch" class="btn-secondary">Retry</button>
            </div>
        </div>
    </div>

    <script type="module" src="src/analysis.js"></script>
</body>

</html>